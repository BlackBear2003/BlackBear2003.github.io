---
title: "计算机网络"
categories:
  - 八股
  - 网络
tags:
  - 计算机网络
---

# 计算机网络

![OSI 七层模型](/assets/images/osi-7-model.png)

多看看这个图，多回忆回忆吧......

## TCP

<img src="/assets/images/tcp-shakes-hands-three-times.png" alt="TCP 三次握手图解" style="zoom:50%;" /><img src="/assets/images/tcp-waves-four-times.png" alt="TCP 四次挥手图解" style="zoom:50%;" />

### 可靠性

**基于数据块传输**：应用数据被分割成 TCP 认为最适合发送的数据块，再传输给网络层，数据块被称为报文段或段。

**对失序数据包重新排序以及去重**：TCP 为了保证不发生丢包，就给每个包一个序列号，有了序列号能够将接收到的数据根据序列号排序，并且去掉重复序列号的数据就可以实现数据包去重。

**校验和**: TCP 将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果收到段的检验和有差错，TCP 将丢弃这个报文段和不确认收到此报文段。

**重传机制** : 在数据包丢失或延迟的情况下，重新发送数据包，直到收到对方的确认应答（ACK）。

### **流量控制**：

**TCP 利用滑动窗口实现流量控制。流量控制是为了控制发送方发送速率，保证接收方来得及接收。** 接收方发送的确认报文中的窗口字段可以用来控制发送方窗口大小，从而影响发送方的发送速率。将窗口字段设置为 0，则发送方不能发送数据。

**滑动过程**：发送方发送数据时，发送窗口随着确认信息的到达而向前滑动，表示已经发送并确认的数据。

### 拥塞控制

TCP 的拥塞控制采用了四种算法，即 **慢开始**、 **拥塞避免**、**快重传** 和 **快恢复**。

![TCP的拥塞控制](/assets/images/tcp-congestion-control.png)

-   **慢开始：** 慢开始算法的思路是当主机开始发送数据时，如果立即把大量数据字节注入到网络，那么可能会引起网络阻塞，因为现在还不知道网络的符合情况。经验表明，较好的方法是先探测一下，即由小到大逐渐增大发送窗口，也就是由小到大逐渐增大拥塞窗口数值。cwnd 初始值为 1，**<u>每经过一个传播轮次，cwnd 加倍</u>**。一旦拥塞窗口大小达到一个**<u>阈值 ssthresh（通常是慢启动阈值）</u>**，发送方就会停止慢启动，并转为拥塞避免状态。
-   **拥塞避免：** 拥塞避免算法的思路是让拥塞窗口 cwnd 缓慢增大，即每经过一个往返时间 RTT 就把发送方的 cwnd 加 1.
-   **快重传与快恢复：**
    -   如果发送方连续收到三个重复的确认报文，就会认为有某个报文丢失了，触发快速重传。
    -   在快速重传后，发送方会**<u>将拥塞窗口减半，会使 ssthresh = cwnd / 2。</u>**然后开始快速恢复过程，逐渐增加拥塞窗口的大小，而不是回到慢启动阶段。

>   RTT（Round Trip Time）：往返时间，也就是数据包从发出去到收到对应 ACK 的时间。
>
>   RTO（Retransmission Time Out）：重传超时时间，即从数据发送时刻算起，超过这个时间便执行重传。
>
>   动态地调整 RTO，TCP 协议采用了一些算法，如加权移动平均（EWMA）算法，Karn 算法。

## PING

PING 基于网络层的 **ICMP**

ICMP 报文中包含了类型字段，用于标识 ICMP 报文类型。ICMP 报文的类型有很多种，但大致可以分为两类：

-   **查询报文类型**：向目标主机发送请求并期望得到响应。
-   **差错报文类型**：向源主机发送错误信息，用于报告网络中的错误情况。

PING 用到的 ICMP Echo Request（类型为 8 ） 和 ICMP Echo Reply（类型为 0） 属于查询报文类型 。

-   PING 命令会向目标主机发送 ICMP Echo Request。
-   如果两个主机的连通性正常，目标主机会返回一个对应的 ICMP Echo Reply。

## DNS

**DNS 是应用层协议，基于 UDP 协议之上，端口为 53** 。

![DNS:域名系统](/assets/images/dns-overview.png)

### DNS记录

DNS 服务器在响应查询时，需要查询自己的数据库，数据库中的条目被称为**资源记录(Resource Record，RR)**。RR 提供了主机名到 IP 地址的映射。RR 是一个包含了`Name`, `Value`, `Type`, `TTL`四个字段的四元组。

```shell
 ~  dig fzu.edu.cn    
 
; <<>> DiG 9.10.6 <<>> fzu.edu.cn
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 9399
;; flags: qr aa rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0001, udp: 4096
;; QUESTION SECTION:
;fzu.edu.cn.			IN	A

;; ANSWER SECTION:
fzu.edu.cn.		1	IN	A	198.18.22.2 

;; Query time: 40 msec
;; SERVER: 198.18.0.2#53(198.18.0.2)
;; WHEN: Fri Mar 01 02:48:56 CST 2024
;; MSG SIZE  rcvd: 65
```

>   fzu.edu.cn.		1	IN	A	198.18.22.2 
>
>   域名              TTL        Type     Value
>
>   因为我就在校园网环境下，所以这个TTL就很小。在校园网环境下，TTL为1可能是因为网络管理员为了增强网络安全性而对流量进行了限制。通过将TTL设置为1，网络管理员可以确保出校园网的流量受到限制，防止一些攻击类型，如反射攻击或DDoS攻击。这样一个报文只能活一跳。

![img](/assets/images/20210506170307897.png)

如果`Type=A`，则`Name`是主机名信息，`Value` 是该主机名对应的 IP 地址。这样的 RR 记录了一条**<u>主机名到 IP 地址的映射</u>**。

如果 `Type=AAAA` （与 `A` 记录非常相似），唯一的区别是 A 记录使用的是 IPv4，而 `AAAA` 记录使用的是 IPv6。

如果`Type=CNAME` (Canonical Name Record,真实名称记录) ，则`Value`是别名为`Name`的主机对应的规范主机名。`Value`值才是规范主机名。`CNAME` 记录**<u>将一个主机名映射到另一个主机名</u>**。`CNAME` 记录用于为现有的 `A` 记录创建别名。下文有示例。

## NAT

在一个小的子网 LAN 内，各主机使用的是同一个 LAN 下的 IP 地址，但在该 LAN 以外，在广域网 WAN 中，需要一个统一的 IP 地址来标识该 LAN 在整个 Internet 上的位置。

NAT 协议的特点，有以下几点：

1.  NAT 协议通过对 WAN 屏蔽 LAN，有效地缓解了 IPv4 地址分配压力。
2.  LAN 主机 IP 地址的变更，无需通告 WAN。
3.  WAN 的 ISP 变更接口地址时，无需通告 LAN 内主机。
4.  LAN 主机对 WAN 不可见，不可直接寻址，可以保证一定程度的安全性。

然而，NAT 协议由于其独特性，存在着一些争议。比如，可能你已经注意到了，**NAT 协议在 LAN 以外，标识一个内部主机时，使用的是端口号，因为 IP 地址都是相同的。**这种将端口号作为主机寻址的行为，可能会引发一些误会。

## ARP

ARP 协议，全称 **地址解析协议（Address Resolution Protocol）**，它解决的是网络层地址和链路层地址之间的转换问题。因为一个 IP 数据报在物理上传输的过程中，总是需要知道下一跳（物理上的下一个目的地）该去往何处，但 IP 地址属于逻辑地址，而 MAC 地址才是物理地址，ARP 协议解决了 IP 地址转 MAC 地址的一些问题。

>   很难说它到底是网络层协议，还是链路层协议，因为它恰恰串联起了网络层和链路层。

当主机发送 IP 数据报文时（网络层），仅知道目的地的 IP 地址，并不清楚目的地的 MAC 地址，而 ARP 协议就是解决这一问题的。